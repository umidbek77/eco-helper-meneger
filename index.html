<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECOHELPER | Tashkilotlar Paneli</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="main-container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h4><i class="bi bi-leaf-fill"></i> ECOHELPER</h4>
        <small>Tashkilotlar Paneli</small>
      </div>
      <div class="sidebar-nav">
        <div class="nav-item">
          <a href="#" class="nav-link active" onclick="showSection('messages')">
            <i class="bi bi-inbox-fill"></i> Qabul qilingan xabarlar
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('map')">
            <i class="bi bi-geo-alt-fill"></i> Xaritadagi muammolar
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('status')">
            <i class="bi bi-check-circle-fill"></i> Holat belgilang
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('response')">
            <i class="bi bi-reply-fill"></i> Fuqaroga javob
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('assign')">
            <i class="bi bi-person-lines-fill"></i> Brigada tayinlash
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('report')">
            <i class="bi bi-file-earmark-pdf-fill"></i> Hisobot yuborish
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('statistics')">
            <i class="bi bi-graph-up-arrow"></i> Statistika
          </a>
        </div>
      </div>
    </nav>
    <!-- Content -->
    <main class="content">
      <!-- Messages Section -->
      <div id="messages" class="section active">
        <div class="page-header">
          <h2><i class="bi bi-inbox-fill"></i> Qabul qilingan xabarlar</h2>
        </div>
        
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th><i class="bi bi-hash"></i> ID</th>
                <th><i class="bi bi-person-fill"></i> Ismi</th>
                <th><i class="bi bi-geo-alt-fill"></i> Hudud</th>
                <th><i class="bi bi-exclamation-triangle-fill"></i> Muammo</th>
                <th><i class="bi bi-calendar-fill"></i> Sana</th>
                <th><i class="bi bi-flag-fill"></i> Holat</th>
                <th><i class="bi bi-image-fill"></i> Rasm</th>
                <th><i class="bi bi-gear-fill"></i> Amallar</th>
              </tr>
            </thead>
            <tbody id="messageList">
              <!-- Dinamik tarzda JS orqali to'ldiriladi -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Map Section -->
      <div id="map" class="section">
        <div class="page-header">
          <h2><i class="bi bi-geo-alt-fill"></i> Muammoli joylar xaritasi</h2>
        </div>
        <div id="mapContainer"></div>
      </div>

      <!-- Status Section -->
      <div id="status" class="section">
        <div class="page-header">
          <h2><i class="bi bi-check-circle-fill"></i> Holat belgilang</h2>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="mb-3">
              <label for="messageSelect" class="form-label">
                <i class="bi bi-envelope-fill"></i> Xabarni tanlang
              </label>
              <select class="form-select" id="messageSelect">
                <option value="">Xabar tanlang...</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="statusSelect" class="form-label">
                <i class="bi bi-flag-fill"></i> Yangi holat
              </label>
              <select class="form-select" id="statusSelect">
                <option value="">Holat tanlang...</option>
                <option value="progress">Bajarilmoqda</option>
                <option value="completed">Yakunlandi</option>
                <option value="pending">Kutilmoqda</option>
              </select>
            </div>
            
            <button class="btn btn-primary" onclick="updateStatus()">
              <i class="bi bi-check-lg"></i> Holatni yangilash
            </button>
          </div>
        </div>
      </div>

      <!-- Response Section -->
      <div id="response" class="section">
        <div class="page-header">
          <h2><i class="bi bi-reply-fill"></i> Fuqaroga javob yozish</h2>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="mb-3">
              <label for="responseMessageSelect" class="form-label">
                <i class="bi bi-envelope-fill"></i> Xabarni tanlang
              </label>
              <select class="form-select" id="responseMessageSelect">
                <option value="">Javob beriladigan xabarni tanlang...</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="responseText" class="form-label">
                <i class="bi bi-chat-text-fill"></i> Javob matni
              </label>
              <textarea class="form-control" id="responseText" rows="5" placeholder="Javob matnini kiriting..."></textarea>
            </div>
            
            <button class="btn btn-success" onclick="sendResponse()">
              <i class="bi bi-send-fill"></i> Javob yuborish
            </button>
          </div>
        </div>
      </div>

      <!-- Assign Section -->
      <div id="assign" class="section">
        <div class="page-header">
          <h2><i class="bi bi-person-lines-fill"></i> Brigada tayinlash</h2>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="mb-3">
              <label for="assignMessageSelect" class="form-label">
                <i class="bi bi-envelope-fill"></i> Xabarni tanlang
              </label>
              <select class="form-select" id="assignMessageSelect">
                <option value="">Topshiriq beriladigan xabarni tanlang...</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="brigadeSelect" class="form-label">
                <i class="bi bi-people-fill"></i> Brigadani tanlang
              </label>
              <select class="form-select" id="brigadeSelect">
                <option value="">Brigada tanlang...</option>
                <option value="cleaning">1-Brigada (Tozalash)</option>
                <option value="landscaping">2-Brigada (Obodonlashtirish)</option>
                <option value="maintenance">3-Brigada (Texnik xizmat)</option>
                <option value="emergency">4-Brigada (Shoshilinch)</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="executorName" class="form-label">
                <i class="bi bi-person-badge-fill"></i> Mas'ul xodim
              </label>
              <input type="text" class="form-control" id="executorName" placeholder="Mas'ul xodim ismini kiriting">
            </div>
            
            <div class="mb-3">
              <label for="assignmentNote" class="form-label">
                <i class="bi bi-sticky-fill"></i> Qo'shimcha izoh
              </label>
              <textarea class="form-control" id="assignmentNote" rows="3" placeholder="Topshiriq bo'yicha qo'shimcha ma'lumot..."></textarea>
            </div>
            
            <button class="btn btn-warning" onclick="assignBrigade()">
              <i class="bi bi-person-check-fill"></i> Topshiriq berish
            </button>
          </div>
        </div>
      </div>

      <!-- Report Section -->
      <div id="report" class="section">
        <div class="page-header">
          <h2><i class="bi bi-file-earmark-pdf-fill"></i> Hisobot yuborish</h2>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body text-center">
                <i class="bi bi-file-earmark-pdf-fill text-danger" style="font-size: 3rem;"></i>
                <h5 class="mt-3">Kunlik hisobot</h5>
                <p class="text-muted">Bugungi bajarilgan ishlar hisoboti</p>
                <button class="btn btn-danger" onclick="downloadReport('daily')">
                  <i class="bi bi-download"></i> Yuklab olish
                </button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-body text-center">
                <i class="bi bi-file-earmark-excel-fill text-success" style="font-size: 3rem;"></i>
                <h5 class="mt-3">Haftalik hisobot</h5>
                <p class="text-muted">Haftalik statistika va tahlil</p>
                <button class="btn btn-success" onclick="downloadReport('weekly')">
                  <i class="bi bi-download"></i> Yuklab olish
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Section -->
      <div id="statistics" class="section">
        <div class="page-header">
          <h2><i class="bi bi-graph-up-arrow"></i> Statistika</h2>
        </div>
        
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="totalMessages">0</div>
              <div>Jami xabarlar</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="completedTasks">0</div>
              <div>Bajarilgan</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="pendingTasks">0</div>
              <div>Kutilayotgan</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card">
              <div class="stats-number" id="progressTasks">0</div>
              <div>Jarayonda</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Notification Container -->
  <div id="notificationContainer"></div>

  <!-- Image Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Rasm ko'rish</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img id="modalImage" class="img-fluid" style="max-height: 500px;">
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>